



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="This hands-on workshop is where you will learn about a number of AWS services that will enable you to securely administer your systems in AWS as we walk through real-world threat scenarios. Learn about the secure administration capabilities of AWS Session Manager, AWS Identity and Access Management and Amazon EC2 Instance Connect.">
      
      
        <link rel="canonical" href="https://idm-infrastructure.awssecworkshops.com/03-using-EC2-Instance-Connect/">
      
      
        <meta name="author" content="aws-security-workshops@amazon.com">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/aws-favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.2.0">
    
    
      
        <title>Module 3: EC2 Instance Connect - Infrastructure Identity in AWS</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.750b69bd.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../stylesheets/custom.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#module-3-using-amazon-ec2-instance-connect" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <!--
  Copyright (c) 2016-2018 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Application header -->
<header class="md-header" data-md-component="header">

    <!-- Top-level navigation -->
    <nav class="md-header-nav md-grid">
      <div class="md-flex">

        <!-- Link to home -->
        <div class="md-flex__cell md-flex__cell--shrink">
          <a href="https://aws.amazon.com/"
              title="Amazon Web Services"
              class="md-header-nav__button md-logo">
            
              <img src="../assets/images/aws_smile_logo.png" width="40" height="24" />
            
          </a>
        </div>

        <!-- Button to toggle drawer -->
        <div class="md-flex__cell md-flex__cell--shrink">
          <label class="md-icon md-icon--menu md-header-nav__button"
              for="__drawer"></label>
        </div>

        <!-- Header title -->
        <div class="md-flex__cell md-flex__cell--stretch">
          <div class="md-flex__ellipsis md-header-nav__title"
              data-md-component="title">
            
              
                <span class="md-header-nav__topic">
                  Infrastructure Identity in AWS
                </span>
                <span class="md-header-nav__topic">
                  Module 3: EC2 Instance Connect
                </span>
              
            
          </div>
        </div>


        <!-- Button to open search dialogue -->
        <!--
        <div class="md-flex__cell md-flex__cell--shrink">
          
            
              <label class="md-icon md-icon--search md-header-nav__button"
                  for="__search"></label>

              
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
            
          
        </div>

         -->

         <div class="md-flex__cell md-flex__cell--shrink">
            <div class="md-flex__ellipsis md-header-nav__lang">
                <div>
                    <button onclick="window.location.href = 'https://awssecworkshops.com/';" class="md-lang-dropbtn fa fa-home"></button>
                </div>
            </div>
        </div>

        <!-- Repository containing source -->
        
          <div class="md-flex__cell md-flex__cell--shrink">
            <div class="md-header-nav__source">
              


  

<a href="https://github.com/aws-samples/aws-infrastructure-identity-workshop/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    aws-samples/aws-secure-access-infrastructure-identity-workshop
  </div>
</a>
            </div>
          </div>
        
      </div>
    </nav>
  </header>
    
    <div class="md-container">
      
        
      
      
        

<nav class="md-tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href=".." title="Overview" class="md-tabs__link md-tabs__link--active">
        Overview
      </a>
    
  </li>

      
        
      
        
      
        
      
        
      
        
      
        
      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <!--
  Copyright (c) 2016-2019 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Main navigation -->
<nav class="md-nav md-nav--primary" data-md-level="0">

  <!-- Site title -->
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://idm-infrastructure.awssecworkshops.com/"
        title="Infrastructure Identity in AWS" class="md-nav__button md-logo">
      
        <img src="../assets/images/aws_smile_logo.png" width="48" height="48" />
      
    </a>
    Infrastructure Identity
  </label>

  <!-- Repository containing source -->
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/aws-samples/aws-infrastructure-identity-workshop/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    aws-samples/aws-secure-access-infrastructure-identity-workshop
  </div>
</a>
    </div>
  

  <!-- Render item list -->
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../01-environment-setup/" title="Module 1: Environment Build" class="md-nav__link">
      Module 1: Environment Build
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../02-using-AWS-Systems-Manager-Session-Manager/" title="Module 2: Session Manager" class="md-nav__link">
      Module 2: Session Manager
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Module 3: EC2 Instance Connect
      </label>
    
    <a href="./" title="Module 3: EC2 Instance Connect" class="md-nav__link md-nav__link--active">
      Module 3: EC2 Instance Connect
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#build-an-ec2-instance-and-install-the-ec2-instance-connect-client" title="Build an EC2 Instance and install the EC2 Instance Connect client." class="md-nav__link">
    Build an EC2 Instance and install the EC2 Instance Connect client.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iam-roles-and-permissions-to-enable-ec2-instance-connect" title="IAM roles and permissions to enable EC2 Instance Connect" class="md-nav__link">
    IAM roles and permissions to enable EC2 Instance Connect
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#confirm-access" title="Confirm Access" class="md-nav__link">
    Confirm Access
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../04-cleanup/" title="Module 4: Cleanup" class="md-nav__link">
      Module 4: Cleanup
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../contribute/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#build-an-ec2-instance-and-install-the-ec2-instance-connect-client" title="Build an EC2 Instance and install the EC2 Instance Connect client." class="md-nav__link">
    Build an EC2 Instance and install the EC2 Instance Connect client.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iam-roles-and-permissions-to-enable-ec2-instance-connect" title="IAM roles and permissions to enable EC2 Instance Connect" class="md-nav__link">
    IAM roles and permissions to enable EC2 Instance Connect
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#confirm-access" title="Confirm Access" class="md-nav__link">
    Confirm Access
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/aws-samples/aws-infrastructure-identity-workshop/edit/master/docs/03-using-EC2-Instance-Connect.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="module-3-using-amazon-ec2-instance-connect">Module 3: Using Amazon EC2 Instance Connect</h1>
<p>In the last module you used AWS Systems Manager Session Manager to securely access and administer your on-premise systems and Amazon EC2 Instances. Recently we announced a new feature that can be used for secure administration of EC2 Instances called Amazon EC2 Instance Connect. Amazon EC2 Instance Connect provides a simple and secure way to connect to your instances using Secure Shell (SSH). With EC2 Instance Connect, you use AWS Identity and Access Management (IAM) policies and principals to control SSH access to your instances, removing the need to share and manage SSH keys.</p>
<p>When you connect to an instance using EC2 Instance Connect, the Instance Connect API pushes a one-time-use SSH public key to the instance metadata where it remains for 60 seconds. The IAM policy attached to your IAM user authorizes your IAM user to push the public key to the instance metadata. The AuthorizedKeysCommand and AuthorizedKeysCommandUser, configured when Instance Connect is installed, tells the SSH daemon to look up the public key from the instance metadata for authentication, and connects you to the instance.</p>
<p>You can use Instance Connect to connect to your instances using any SSH client of your choice or the Instance Connect CLI, or you can connect to your instances by using the new browser-based SSH client in the Amazon EC2 console.</p>
<p><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-connect-set-up.html" target="_blank">More Information and a list of currently supported Operating Systems</a></p>
<h2 id="build-an-ec2-instance-and-install-the-ec2-instance-connect-client">Build an EC2 Instance and install the EC2 Instance Connect client.</h2>
<p>EC2 Instance connect is already installed on all version of Amazon Linux 2, however we will use Ubuntu Server and install the client so we can become familiar with the process.</p>
<p>1.This lab will be executed from your Cloud9IDE. Go to Outputs tab from your <strong>InfrastructureIdentity-Env-Setup</strong> CloudFormation stack, and click on the value next to Cloud9IDE. Make sure your credentials are still in place on the Cloud9IDE, for additional details follow quickly configuring the AWS CLI You may need to disable AWS managed temporary credentials in Cloud9 Preference, AWS Settings, Credentials.</p>
<p>2.Go back to <strong>CloudFormation</strong>, find the stack that starts with <strong>aws-cloud9-</strong>, click on <strong>Resources</strong> and take note Security Group ID (sg-abc123) for <strong>InstanceSecurityGroup</strong>. Next, find the CloudFormation Stack named <strong>InfrastructureIdentity-Env-Setup</strong>, click on <strong>Resources</strong> and take note of the subnet-id (subnet-abc123) for <strong>PublicSubnet1</strong>, you will use these in steps 3-6.</p>
<p>3.Create a text file named connect-install.txt, using the following contents:</p>
<div class="codehilite"><pre><span></span><span class="err">#!/bin/bash</span>
<span class="err">apt-get</span> <span class="err">update</span>
<span class="err">apt-get</span> <span class="err">install</span> <span class="err">ec</span><span class="mi">2</span><span class="err">-instance-connect</span>
<span class="err">less</span> <span class="err">/lib/systemd/system/ssh.service.d/ec</span><span class="mi">2</span><span class="err">-instance-connect.conf</span>
</pre></div>


<p>4.The following command will build an Ubuntu instance with EC2-Instance-Connect installed using user-data, using the Security Group ID and Public Subnet created for us earlier, using the following cli command:</p>
<blockquote>
<p>Before you run the command below remove all quotes and replace "subnet-xx" and "sg-xx" with the information from the previous step and your SSH key.</p>
</blockquote>
<div class="codehilite"><pre><span></span>aws ec2 run-instances --image-id ami-026c8acd92718196b --instance-type t1.micro --subnet-id subnet-xx --security-group-ids sg-xx --associate-public-ip-address --tag-specifications <span class="s1">&#39;ResourceType=instance,Tags={Key=&quot;Name&quot;,Value=&quot;EC2ConnectInstance&quot;}&#39;</span> --user-data file://connect-install.txt
</pre></div>


<p>5.You will see the output that includes details about the instance you just created. Take note of the instance-id as we will use it in the next section.</p>
<div class="codehilite"><pre><span></span>    <span class="s2">&quot;InstanceId&quot;</span><span class="err">:</span> <span class="s2">&quot;i-000abcdefghijklmn&quot;</span><span class="err">,</span>
</pre></div>


<p>6.Update the Cloud9 security group named <strong>aws-cloud9-InfrastructureIdentity-Env-Setup-Cloud9Instance-</strong> to allow inbound SSH from <strong>0.0.0.0/0</strong>.</p>
<h2 id="iam-roles-and-permissions-to-enable-ec2-instance-connect">IAM roles and permissions to enable EC2 Instance Connect</h2>
<p>1.Now we will create and attach an IAM Custom Policy to MyWorkshopUser. Create a Custom IAM Policy named InstanceConnect.json. Update the "i-xx" with the instance-id that you noted earlier. Copy the json code below and paste it into a new file called InstanceConnect.json</p>
<blockquote>
<p>This file must reside in the same directory where your CLI session is running, or you must specify the location.</p>
</blockquote>
<div class="codehilite"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
    <span class="nt">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">[{</span>
        <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
        <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="s2">&quot;ec2-instance-connect:SendSSHPublicKey&quot;</span><span class="p">,</span>
        <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="s2">&quot;arn:aws:ec2:region:account-id:instance/i-xx&quot;</span><span class="p">,</span>
        <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;StringEquals&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;ec2:osuser&quot;</span><span class="p">:</span> <span class="s2">&quot;ubuntu&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}]</span>
<span class="p">}</span>
</pre></div>


<blockquote>
<ul>
<li>The ec2-instance-connect:SendSSHPublicKey action grants an IAM user permission to push the public key to an instance.</li>
<li>The ec2:osuser condition specifies the default user name for the AMI that you used to launch your instance. For Amazon Linux 2, the default user name is ec2-user. For the Ubuntu AMI, the default user name is ubuntu.</li>
</ul>
</blockquote>
<p>2.Create the IAM policy using the file you just created</p>
<div class="codehilite"><pre><span></span>aws iam create-policy --policy-name InstanceConnect --policy-document file://InstanceConnect.json
</pre></div>


<p>The result should return the following:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;Policy&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;PolicyName&quot;</span><span class="p">:</span> <span class="s2">&quot;InstanceConnect&quot;</span><span class="p">,</span>
        <span class="nt">&quot;PermissionsBoundaryUsageCount&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nt">&quot;CreateDate&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-07-23T19:58:59Z&quot;</span><span class="p">,</span>
        <span class="nt">&quot;AttachmentCount&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nt">&quot;IsAttachable&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nt">&quot;PolicyId&quot;</span><span class="p">:</span> <span class="s2">&quot;ANPAXMAS344KJ6Q7CGW4F&quot;</span><span class="p">,</span>
        <span class="nt">&quot;DefaultVersionId&quot;</span><span class="p">:</span> <span class="s2">&quot;v1&quot;</span><span class="p">,</span>
        <span class="nt">&quot;Path&quot;</span><span class="p">:</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
        <span class="nt">&quot;Arn&quot;</span><span class="p">:</span> <span class="s2">&quot;arn:aws:iam::abc123:policy/InstanceConnect&quot;</span><span class="p">,</span>
        <span class="nt">&quot;UpdateDate&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-07-23T19:58:59Z&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>3.To attach the policy, use the attach-user-policy command, and reference the environment variable that holds the policy ARN.</p>
<div class="codehilite"><pre><span></span>aws iam attach-user-policy --user-name MyWorkshopUser --policy-arn arn:aws:iam::abc123:policy/InstanceConnect
</pre></div>


<h2 id="confirm-access">Confirm Access</h2>
<p>1.You can connect to an instance as the MyWorkshopUser, login as that user with a different browser.</p>
<p>2.Go to <strong>EC2</strong>, select <strong>Instances</strong>, select the <strong>EC2ConnectInstance</strong>. Select <strong>Connect</strong> and choose the option to <strong>connect with EC2 Instance Connect (browser-based SSH connection)</strong>. Update the user name to <strong>ubuntu</strong>. EC2 Instance Connect performs the following three actions in one call: it generates a one-time-use SSH public key, pushes the key to the instance where it remains for 60 seconds, and connects the user to the instance. You can use basic SSH/SFTP commands with the Instance Connect CLI.</p>
<p>3.You should see the EC2 Instance Connect (browser-based SSH connection) appear.</p>
<p><img alt="EC2 Instance Connection" src="../images/InstanceConnectUbuntu.png" /></p>
<blockquote>
<ul>
<li>The command “w” displays the detailed information about the users who are logged in the system currently.</li>
<li>The simple “date” command displays the current date and time (including the day of the week, month, time, time zone, year).
Enter in the following commands:</li>
</ul>
</blockquote>
<div class="codehilite"><pre><span></span>w
date
</pre></div>


<p>The results should look similar to this:</p>
<p><img alt="EC2 Instance Connect Browser" src="../images/InstanceConnectUbuntuBrowser.png" /></p>
<p>4.Now that you've seen how Session Manager and EC2 Instance Connect work.</p>
<blockquote>
<ul>
<li>What do you think?</li>
<li>What are the Pros &amp; Cons for using each?</li>
<li>What is your preference?</li>
</ul>
</blockquote>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../02-using-AWS-Systems-Manager-Session-Manager/" title="Module 2: Session Manager" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Module 2: Session Manager
              </span>
            </div>
          </a>
        
        
          <a href="../04-cleanup/" title="Module 4: Cleanup" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Module 4: Cleanup
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            &copy; 2019, Amazon Web Services, Inc. or its affiliates. All rights reserved.
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://awssecworkshops.com" class="md-footer-social__link fa fa-home"></a>
    
      <a href="https://aws.amazon.com/security/" class="md-footer-social__link fa fa-shield"></a>
    
      <a href="https://twitter.com/awssecurityinfo?lang=en" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://aws.amazon.com/blogs/security/" class="md-footer-social__link fa fa-rss"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.39abc4af.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>